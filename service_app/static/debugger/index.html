<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Visual Debugger for Reasoning</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&family=IBM+Plex+Mono:wght@400;500&display=swap"
      rel="stylesheet"
    />
    <link
      id="debuggerStylesheet"
      rel="stylesheet"
      href="/static/debugger/styles.css"
    />
    <script>
      const stylesheet = document.getElementById("debuggerStylesheet");
      if (stylesheet) {
        const cacheToken = `v=${Date.now()}`;
        const primaryHref =
          window.location.protocol === "file:"
            ? "./styles.css"
            : "/static/debugger/styles.css";

        stylesheet.href = `${primaryHref}?${cacheToken}`;
        stylesheet.addEventListener("error", () => {
          if (stylesheet.dataset.fallbackApplied === "1") {
            return;
          }
          stylesheet.dataset.fallbackApplied = "1";
          stylesheet.href = `./styles.css?${cacheToken}`;
        });
      }
    </script>
  </head>
  <body>
    <div class="bg-shape shape-a"></div>
    <div class="bg-shape shape-b"></div>
    <main class="page-shell">
      <section class="hero">
        <p class="eyebrow">Demo Interface</p>
        <h1>Visual Debugger for Reasoning</h1>
        <p class="hero-copy">
          Inspect sampled trajectories, tree expansions, verifier reranking, and the score signals behind every escalation decision.
        </p>
      </section>

      <section class="panel cached-example-panel">
        <div class="section-head compact cached-head">
          <div>
            <h2>Cached Example Explorer</h2>
            <p>Choose a cached example and case in one place.</p>
          </div>
          <label class="cache-toggle" for="useCachedToggle">
            <input id="useCachedToggle" type="checkbox" />
            <span class="cache-toggle-track" aria-hidden="true"></span>
            <span class="cache-toggle-label">Use Cached Example</span>
          </label>
        </div>
        <div id="cachedExplorerControls" class="controls cached-controls hidden">
          <label class="control">
            <span>Scenario</span>
            <select id="scenarioSelect"></select>
          </label>
          <label class="control">
            <span>Case</span>
            <select id="caseSelect"></select>
          </label>
        </div>
        <div id="cachedExplorerPrompt" class="prompt-strip embedded-prompt-strip hidden">
          <div>
            <p class="prompt-label">Prompt</p>
            <p id="promptText" class="prompt-text"></p>
            <p id="promptMeta" class="prompt-meta"></p>
          </div>
          <div class="ground-truth-box">
            <p>Ground truth</p>
            <strong id="groundTruth">-</strong>
          </div>
        </div>
      </section>

      <section class="panel custom-input-panel">
        <div class="section-head compact">
          <h2>Custom Input Runner</h2>
          <p>Validate model capabilities, then run one strategy with optional scorer.</p>
        </div>
        <div class="custom-controls">
          <label class="control">
            <span>Provider</span>
            <select id="providerSelect">
              <option value="openai">OpenAI</option>
              <option value="openrouter">OpenRouter</option>
            </select>
          </label>
          <label class="control grow">
            <span>Model ID</span>
            <input
              id="modelIdInput"
              type="text"
              value="gpt-4o-mini"
              placeholder="e.g. gpt-4o-mini or deepseek/deepseek-r1-0528"
            />
          </label>
          <label class="control grow">
            <span>API Key</span>
            <input
              id="modelApiKeyInput"
              type="password"
              placeholder="sk-... or sk-or-v1-..."
              autocomplete="off"
            />
          </label>
          <button id="validateModelButton" type="button">Validate Model</button>
        </div>
        <p id="modelCapabilityStatus" class="custom-status">
          Validate a model first to unlock compatible strategy/scorer options.
        </p>

        <div class="custom-controls">
          <label class="control">
            <span>Strategy</span>
            <select id="strategySelect" disabled>
              <option value="">Validate model first</option>
            </select>
          </label>
          <label class="control">
            <span>Scorer</span>
            <select id="scorerSelect" disabled>
              <option value="">Validate model first</option>
            </select>
          </label>
        </div>

        <button
          id="advancedConfigToggle"
          class="advanced-config-toggle"
          type="button"
          aria-expanded="false"
        >
          Show Advanced config
        </button>
        <div id="advancedConfigPanel" class="advanced-config-panel hidden">
          <label class="control">
            <span>System prompt (optional)</span>
            <textarea
              id="advancedPromptInput"
              rows="2"
              placeholder="Example: Reason step-by-step and put the final answer in \\boxed{}."
            >Reason step-by-step carefully</textarea>
          </label>
          <label class="control">
            <span>Advanced config (YAML)</span>
            <div class="yaml-editor">
              <pre
                id="advancedConfigHighlight"
                class="yaml-highlight"
                aria-hidden="true"
              ></pre>
              <textarea
                id="advancedConfigYamlInput"
                rows="14"
                wrap="off"
                spellcheck="false"
                placeholder="prompt: \"\"\ngeneration:\n  temperature: 0.7\nstrategy:\n  type: baseline"
              ></textarea>
            </div>
          </label>
          <div class="custom-actions">
            <button id="resetAdvancedConfigButton" type="button" class="ghost">
              Reset Advanced Config
            </button>
          </div>
          <p id="advancedConfigStatus" class="custom-status">
            YAML template will load after selecting strategy and scorer.
          </p>
        </div>

        <!-- <p id="modelConfigNote" class="custom-note">
          Note: system prompt is managed in this Advanced config section and synced into YAML `prompt` on run. Model validation uses the entered API key. Full production execution still relies on backend environment wiring.
        </p> -->

        <div class="custom-mode-section">
          <label class="control grow">
            <span>Question</span>
            <textarea
              id="singleQuestionInput"
              rows="3"
              placeholder="Enter one question to evaluate"
            ></textarea>
          </label>
        </div>

        <div class="custom-actions">
          <button id="runCustomButton" type="button" disabled>
            Run Selected Strategy
          </button>
          <button id="resetDemoButton" type="button" class="ghost">
            Clear
          </button>
        </div>

        <p id="customStatus" class="custom-status">
          Enter one question and run the selected strategy.
        </p>
      </section>

      <section>
        <div class="section-head">
          <h2>Strategy Comparison</h2>
          <p>Run result overview (score and tokens).</p>
        </div>
        <div id="strategyGrid" class="strategy-grid"></div>
      </section>

      <section class="workspace">
        <div class="panel timeline-panel">
          <div class="section-head compact">
            <h2>Reasoning Timeline</h2>
            <p id="timelineHint">Select a step to inspect content and scores.</p>
          </div>
          <div id="timeline" class="timeline"></div>
        </div>

        <div class="panel details-panel">
          <div class="section-head compact">
            <h2>Step Inspector</h2>
            <p id="stepTitle">Pick a timeline step.</p>
          </div>

          <div id="decisionBox" class="decision-box"></div>
          <div id="signals" class="signals"></div>

          <div class="subsection-head">
            <h3>Candidates</h3>
          </div>
          <div id="candidates" class="candidate-grid"></div>

          <div class="subsection-head">
            <h3>Candidate Detail</h3>
          </div>
          <div id="candidateDetail" class="candidate-detail"></div>
        </div>
      </section>

      <section class="panel">
        <div class="section-head compact">
          <h2>Trajectory Tree</h2>
          <p>Global branching view for the selected strategy run.</p>
        </div>
        <div id="treeContainer" class="tree-container"></div>
      </section>
    </main>

    <script>
      (() => {
        const assetBase =
          window.location.protocol === "file:" ? "." : "/static/debugger";
        const cacheToken = `v=${Date.now()}`;

        const appendScript = (src, onDone) => {
          const script = document.createElement("script");
          script.src = src;
          script.onload = () => {
            if (onDone) {
              onDone();
            }
          };
          script.onerror = () => {
            if (onDone) {
              onDone();
            }
          };
          document.body.appendChild(script);
        };

        appendScript(`${assetBase}/app.js?${cacheToken}`);
      })();
    </script>
  </body>
</html>
